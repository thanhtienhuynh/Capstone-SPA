<mat-horizontal-stepper #stepper>
  <mat-step #stepOne [stepControl]="secondFormGroup" editable="true">
    <div class="center">
      <form
        *ngIf="secondFormGroup != null; elseNull"
        [formGroup]="secondFormGroup"
        (ngSubmit)="getAction(1)"
      >
        <ng-template matStepLabel>Nhập điểm</ng-template>

        <h1 class="step-1-title">Nhập điểm trung bình học bạ hoặc điểm thi THPT Quốc gia</h1>

        <div fxLayout="row wrap" fxLayoutGap="32px" fxLayoutAlign="center" class="criteria-frame">
          <div fxFlex.lg="0 1 calc(50%)" fxFlex.lt-md="0 1 calc(100%)" fxFlex.lt-sm="100%">

            <div class="center-vertical">
              <div class="criteria-lable">Tỉnh đang sinh sống: </div>
              <mat-form-field class="province-field">
                <mat-label>Tỉnh, thành phố:</mat-label>
                <input type="text"
                       placeholder="Chọn tỉnh, thành"
                       required
                       matInput
                       formControlName="province"
                       [matAutocomplete]="auto"
                       [(ngModel)]="provinceId">
                <mat-autocomplete  autoActiveFirstOption #auto="matAutocomplete" [displayWith]="getProvinceName.bind(this)" >
                  <mat-option *ngFor="let option of filteredOptions | async" [value]="option.id">
                    {{option.name}}
                  </mat-option>
                </mat-autocomplete>
              </mat-form-field>
            </div>

            <div class="center-vertical" >
              <label class="criteria-lable">Giới tính: </label>
              <mat-radio-group [(ngModel)]="gender" formControlName="gender">
                <mat-radio-button class="radio-choice" [checked]="'true'" [value]="1">Nữ</mat-radio-button>
                <mat-radio-button [value]="0">Nam</mat-radio-button>
              </mat-radio-group>
            </div>

             <div class="center-vertical" style="margin-top: 20px;">
              <label class="criteria-lable">Loại điểm: </label>
              <mat-radio-group [(ngModel)]="typeScore" formControlName="transcriptTypeId">
                <mat-radio-button class="radio-choice" [checked]="'true'" [value]="2">Điểm học bạ</mat-radio-button>
                <mat-radio-button [value]="1">Điểm THPT QG</mat-radio-button>
              </mat-radio-group>
            </div>

          </div>
        </div>

        <div>
          <mat-form-field *ngFor="let subject of subjects; let i = index">
            <mat-label>{{ subject.name }}</mat-label>
            <input
              class="score-field"
              type="number"
              matInput
              min="0"
              max="10"
              formControlName="{{ subject.id }}"
              placeholder="Điểm {{ subject.name }}"

            />
            <mat-error
              *ngIf="_generalService.hasErrorInputValidation(subject.id, 'max', secondFormGroup)"
            >
              Mark between <strong>0 - 10</strong>
            </mat-error>
            <mat-error
              *ngIf="_generalService.hasErrorInputValidation(subject.id, 'min', secondFormGroup)"
            >
              Mark between <strong>0 - 10</strong>
            </mat-error>
          </mat-form-field>
          <div class="center-horizontal" *ngIf="secondFormGroup.invalid && secondFormGroup.errors">
            <mat-error *ngIf="secondFormGroup.errors.mustHigherThanFive != null">{{secondFormGroup.errors.mustHigherThanFive}}</mat-error>
            <mat-error *ngIf="secondFormGroup.errors.atLeastSixSubjects">{{secondFormGroup.errors.atLeastSixSubjects}}</mat-error>
            <mat-error *ngIf="secondFormGroup.errors.mustEnoughSubjects">{{secondFormGroup.errors.mustEnoughSubjects}}</mat-error>
            <mat-error *ngIf="secondFormGroup.errors.mustMatchGroup">{{secondFormGroup.errors.mustMatchGroup}}</mat-error>
          </div>
        </div>
        <div style="width: 100%; margin: auto;">
          <button [disabled]="secondFormGroup.invalid" style="margin: 15px 40%;" mat-raised-button color="primary">
            Xem kết quả
          </button>
        </div>
      </form>
    </div>
  </mat-step>
  <mat-step #stepTwo >
    <ng-template matStepLabel>Kết quả</ng-template>
    <div class="center">
      <div *ngIf="suggestedSubjectsGroup && suggestedSubjectsGroup.length > 0" fxLayout="row wrap" fxLayoutGap="32px" fxLayoutAlign="flex-start" style="width: 100%; height: auto;">
        <!-- Top 2 -->
        <div fxFlex.lg="0 1 calc(32% -32px )" fxFlex.lt-md="0 1 calc(100%)" fxFlex.lt-sm="100%" >
          <div *ngIf="suggestedSubjectsGroup && suggestedSubjectsGroup[1]" class="top-2-group-frame">
            <div class="top-2-group-in-frame">  
              <div class="top-2-group-inner-frame">
                <div class="top-2-title-frame">
                  <div class="top-2-title">Top 2</div>
                </div>
                <div class="low-level-subject-group-frame">
                  <div class="low-level-in-subject-group-frame">
                    <div class="top-2-out-circle-frame"
                    #tooltip="matTooltip"
                    [matTooltip]="getSubjectNames(suggestedSubjectsGroup[1])"
                    matTooltipPosition="above"
                    matTooltipHideDelay="100000">
                      <div class="center-vertical top-2-circle-frame">
                        <div class="group-top-2-name">{{suggestedSubjectsGroup[1].name}}</div>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="top-2-major-frame">
                  <div style="height: 91%; width: 100%;" class="major-scroll" id="style-7">
                    <button *ngFor="let major of suggestedSubjectsGroup[1].suggestedMajors" style="width: 100%;" mat-button 
                    (click)="getAction(2, {suggestedSubjectsGroup: suggestedSubjectsGroup[1], major: major})">
                      {{major.name | shorten:22}} 
                      <!-- - {{major.highestEntryMark}} - {{major.weightMark}} -->
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <!-- Top 1 -->
        <div fxFlex="0 1 calc(36% - 32px)" fxFlex.lt-md="0 1 calc(100%)" fxFlex.lt-sm="0 1 calc(100%)">
            <div *ngIf="suggestedSubjectsGroup && suggestedSubjectsGroup[0]" class="top-1-group-in-frame" >  
              <div style="height: 100%; background-color: azure; border-radius: 30px;">
                <div class="top-1-title-frame">
                  <div class="top-1-title">Top 1</div>
                </div>
                <div style="height: 30%; background-color: rgb(231, 238, 240);">
                  <div style="height: 100%; padding-top: 12px;">
                    <div class="top-1-out-circle-frame"
                      #tooltip="matTooltip"
                      [matTooltip]="getSubjectNames(suggestedSubjectsGroup[0])"
                      matTooltipPosition="above"
                      matTooltipHideDelay="100000">
                      <div class="center-vertical top-1-circle-frame">
                        <div class="group-top-1-name">{{suggestedSubjectsGroup[0].name}}</div>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="top-1-major-frame">
                  <div style="height: 91%; width: 100%;" class="major-scroll"  id="style-7">
                    <button *ngFor="let major of suggestedSubjectsGroup[0].suggestedMajors" style="width: 100%;" mat-button 
                      (click)="getAction(2, {suggestedSubjectsGroup: suggestedSubjectsGroup[0], major: major})">
                      {{major.name | shorten:30}}
                       <!-- - {{major.highestEntryMark}} - {{major.weightMark}} -->
                    </button>
                  </div>
                </div>
              </div>
            </div>
        </div>
        <!-- Top 3 -->
        <div *ngIf="suggestedSubjectsGroup && suggestedSubjectsGroup[2]" fxFlex="0 1 calc(32% - 32px)" fxFlex.lt-md="0 1 calc(100%)" fxFlex.lt-sm="0 1 calc(100%)">
          <div style="padding-top: 50px;">
            <div class="top-3-group-in-frame" >  
              <div style="height: 100%; background-color: azure; border-radius: 30px;">
                <div class="top-3-title-frame">
                  <div class="top-3-title">Top 3</div>
                </div>
                <div class="low-level-subject-group-frame">
                  <div class="low-level-in-subject-group-frame">
                    <div class="top-3-out-circle-frame"
                      #tooltip="matTooltip"
                      [matTooltip]="getSubjectNames(suggestedSubjectsGroup[2])"
                      matTooltipPosition="above"
                      matTooltipHideDelay="100000">
                      <div class="center-vertical top-3-circle-frame">
                        <div class="group-top-3-name">{{suggestedSubjectsGroup[2].name}}</div>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="top-3-major-frame">
                  <div style="height: 91%; border-radius: 0px 0px 30px 30px; width: 100%;"  class="major-scroll"  id="style-7" >
                    <button *ngFor="let major of suggestedSubjectsGroup[2].suggestedMajors" style="width: 100%;" mat-button 
                      (click)="getAction(2, {suggestedSubjectsGroup: suggestedSubjectsGroup[2], major: major})">
                      {{major.name  | shorten:22}} 
                      <!-- - {{major.highestEntryMark}}- {{major.weightMark}} -->
                    </button>
                  </div>
                </div>
              </div>
            </div>  
          </div>
        </div>
      </div>
      <div *ngIf="(!suggestedSubjectsGroup || suggestedSubjectsGroup.length == 0) && !isLoading" class="center-all">
        <h3 >Không có khối ngành phù hợp!</h3>
      </div>
      <div style="margin-top: 25px;">
        <button mat-raised-button color="warn" matStepperPrevious>Trở lại</button>
        <!-- <button mat-raised-button color="primary" class="btn-step-one">Xem thêm</button> -->
      </div>
  </div>
  </mat-step>
  <!-- Danh sách trường step -->
  <mat-step  #stepThree >
    <ng-template matStepLabel>Danh sách trường</ng-template>
    <div class="center">
      <div class="uni-list-header-frame" fxLayout="row wrap" fxLayoutGap="grid" fxLayoutAlign="flex-start">
        
        <div fxFlex="0 1 calc(100%)" fxFlex.lt-sm="100%" class="center-horizontal">
          <div class="center-vertical mock-test-title">
            Hệ thống sẽ giúp bạn đánh giá năng lực và xếp hạng chính xác hơn thông qua việc thi thử
          </div>
          <div class="wrap center-vertical mock-test-button">
            <button type="submit" (click)="getAction(3)" class="blob blue">Thi thử</button>
          </div>
        </div>       
      </div>


      <!-- Mới nè -->
      <div *ngIf="mockTestBasedUniversity" fxLayout="row wrap" fxLayoutGap="grid" fxLayoutAlign="flex-start">
        <div class="center-vertical major-title">Danh sách các trường có ngành: {{suggestedMajorName}} - Xét theo điểm thi thử</div>
        <div fxFlex="0 1 calc(100%)"  class="mock-test-score-title">Tổng điểm thi thử của bạn là: {{mockTestBasedUniversity.totalMark}}</div>
        <div *ngIf="mockTestBasedUniversity.trainingProgramBasedUniversityDataSets?.length > 0">
          <div style="height: auto; margin-bottom: 100px; border-style: solid;" *ngFor="let university of mockTestBasedUniversity.trainingProgramBasedUniversityDataSets" fxFlex="0 1 calc(100%)" >
            <div gdAreas="logo name name | logo description information | logo description information" gdGap="10px" gdRows="auto auto auto"
  gdAreas.lt-md="name | logo | description | information" gdRows.lt-md="auto auto auto auto">
              <div gdArea="logo">
                <img class="img-frame" src="{{university.logoUrl}}" alt="">
              </div>
              <h3 class="center-all" gdArea="name">
                {{university.name}}
              </h3>
              <div gdArea="description">
                <div class="first-line-uni-information"><strong>- Mã trường: </strong> {{university.code}}</div>
                <div><strong>- Địa chỉ: </strong> {{university.address}}</div>
                <div><strong>- Số điện thoại: </strong> {{university.phone}}</div>
                <div><strong>- Học phí:</strong> Từ {{university.tuitionFrom | number:'1.0':'en-US'}},000 đến {{university.tuitionTo | number:'1.0':'en-US'}},000/{{ university.tuitionType == 0 ? "Kì" : "Năm"}}</div>
              </div>
              <div gdArea="information">
                <div class="first-line-uni-information"><strong>- Mô tả: </strong> {{university.description}}</div>
                <div><strong>- Chất lượng: </strong> {{university.rating}} sao</div>
                <div><strong>- Web: </strong> <a [href]="university.webUrl | safeUrl">{{university.webUrl}}</a></div>
              </div>
  
            </div>
            <div class="training-program-list-frame" *ngIf="university.trainingProgramSets" fxLayout="row wrap" fxLayoutAlign="center">
              <div class="training-program-item-frame" *ngFor="let trainingProgramSet of university.trainingProgramSets" fxFlex="0 1 calc(33% - 32px)" fxFlex.lt-md="0 1 calc(50% - 32px)" fxFlex.lt-sm="100%">
                <h4 class="center-all">Hệ {{trainingProgramSet.name}}</h4>
                <div><strong>Điểm chuẩn năm {{trainingProgramSet.seasonDataSets[0].name}}:&nbsp;</strong>{{trainingProgramSet.seasonDataSets[0].entryMark}}</div>
                <div><strong>Chỉ tiêu năm {{trainingProgramSet.seasonDataSets[0].name}}:&nbsp;</strong>{{trainingProgramSet.seasonDataSets[0].numberOfStudents}}</div>
                <div><strong>Chỉ tiêu năm {{trainingProgramSet.seasonDataSets[1].name}}:&nbsp;</strong>{{trainingProgramSet.seasonDataSets[1].numberOfStudents}}</div>
                <div><strong>Số người quan tâm hiện tại:&nbsp;</strong>{{trainingProgramSet.numberOfCaring}}</div>
                <div><strong>Bạn đang đứng top:&nbsp;</strong>{{trainingProgramSet.rank}}</div>
                <div class="center-all follow-button-frame">
                  <button *ngIf="!trainingProgramSet.followingDetail" (click)="onCaringClick(university.id, trainingProgramSet.id, 3)" mat-flat-button color="accent">Theo dõi</button>
                  <button *ngIf="trainingProgramSet.followingDetail" (click)="onUncaringClick(trainingProgramSet.followingDetail.id, university.name)" style="background-color: rgba(58, 57, 57, 0.05);" mat-flat-button>Bỏ theo dõi</button>
                </div>
              </div>
             
            </div>
          </div>
        </div>

        <div class="mock-test-score-title" *ngIf="!mockTestBasedUniversity.trainingProgramBasedUniversityDataSets?.length > 0">
          Điểm thi thử của bạn không phù hợp với bất kì trường Đại học nào.
        </div>

      </div>


      <!-- Bắt đầu flex-->
      <div *ngIf="this.typeScore == 2" >
        <div class="center-vertical major-title">Danh sách các trường có ngành: {{suggestedMajorName}} - Xét theo điểm học bạ</div>
      </div>
      <div *ngIf="this.typeScore == 1" >
        <div class="center-vertical major-title">Danh sách các trường có ngành: {{suggestedMajorName}} - Xét theo điểm THPT QG</div>
      </div>
      <div *ngIf="this.trainingProgramBasedUniversity && this.trainingProgramBasedUniversity.length > 0" fxLayout="row wrap" fxLayoutGap="grid" fxLayoutAlign="flex-start">
        <div style="height: auto; border: 1px solid;" *ngFor="let university of trainingProgramBasedUniversity" fxFlex="0 1 calc(100%)" >
          <div gdAreas="logo name name | logo description information | logo description information" gdGap="10px" gdRows="auto auto auto"
gdAreas.lt-md="name | logo | description | information" gdRows.lt-md="auto auto auto auto">
            <div gdArea="logo">
              <img class="img-frame" src="{{university.logoUrl}}" alt="">
            </div>
            <h3 class="center-all" gdArea="name">
              {{university.name}}
            </h3>
            <div gdArea="description">
              <div class="first-line-uni-information"><strong>- Mã trường: </strong> {{university.code}}</div>
              <div><strong>- Địa chỉ: </strong> {{university.address}}</div>
              <div><strong>- Số điện thoại: </strong> {{university.phone}}</div>
              <div *ngIf="university.tuitionTo == university.tuitionFrom">
                <strong>- Học phí:</strong> khoảng {{university.tuitionTo | number:'1.0':'en-US'}},000/{{university.tuitionType == 0 ? "kì" : "năm"}}
              </div>
              <div *ngIf="university.tuitionTo != university.tuitionFrom">
                <strong>- Học phí:</strong>: từ {{university.tuitionFrom | number:'1.0':'en-US'}},000
                đến {{university.tuitionTo | number:'1.0':'en-US'}},000/
                {{ university.tuitionType == 0 ? "kì" : "năm"}}
              </div>
            </div>
            <div gdArea="information">
              <div class="first-line-uni-information"><strong>- Mô tả: </strong> {{university.description}}</div>
              <div><strong>- Chất lượng: </strong> {{university.rating}} sao</div>
              <div><strong>- Web: </strong> <a [href]="university.webUrl | safeUrl">{{university.webUrl}}</a></div>
            </div>

          </div>

          <div class="training-program-list-frame" *ngIf="university.trainingProgramSets" fxLayout="row wrap" fxLayoutAlign="center">
            <div class="training-program-item-frame" *ngFor="let trainingProgramSet of university.trainingProgramSets" fxFlex="0 1 calc(33% - 32px)" fxFlex.lt-md="0 1 calc(50% - 32px)" fxFlex.lt-sm="100%">
              <h4 class="center-all">Hệ {{trainingProgramSet.name}}</h4>
              <div><strong>Điểm chuẩn năm {{trainingProgramSet.seasonDataSets[0].name}}:&nbsp;</strong>{{trainingProgramSet.seasonDataSets[0].entryMark}}</div>
              <div><strong>Chỉ tiêu năm {{trainingProgramSet.seasonDataSets[0].name}}:&nbsp;</strong>{{trainingProgramSet.seasonDataSets[0].numberOfStudents}}</div>
              <div><strong>Chỉ tiêu năm {{trainingProgramSet.seasonDataSets[1].name}}:&nbsp;</strong>{{trainingProgramSet.seasonDataSets[1].numberOfStudents}}</div>
              <div><strong>Số người quan tâm hiện tại:&nbsp;</strong>{{trainingProgramSet.numberOfCaring}}</div>
              <div><strong>Bạn đang đứng top:&nbsp;</strong>{{trainingProgramSet.rank}}</div>
              <div class="center-all follow-button-frame">
              <button *ngIf="!trainingProgramSet.followingDetail" (click)="onCaringClick(university.id, trainingProgramSet.id, this.typeScore)" mat-flat-button color="accent">Theo dõi</button>
              <button *ngIf="trainingProgramSet.followingDetail" (click)="onUncaringClick(trainingProgramSet.followingDetail.id, university.name)" style="background-color: rgba(58, 57, 57, 0.05);" mat-flat-button>Bỏ theo dõi</button>
              </div>
            </div>
          </div>

        </div>
      </div>
      <div *ngIf="(!trainingProgramBasedUniversity || trainingProgramBasedUniversity.length == 0) && !isLoading">
        <h2>Không có trường đại học nào phù hợp!</h2>
      </div>

      <div style="margin-top: 25px;">
        <button mat-raised-button matStepperPrevious color="warn">Trở lại</button>
      </div>
  </div>
  </mat-step>
  <mat-step  #stepFour >
    <ng-template matStepLabel>Danh sách bài thi</ng-template>
    <div class="center" >
    <div fxLayout="row wrap" fxLayoutGap="32px grid" fxLayoutAlign="flex-start">
      <div *ngFor="let subjectBasedTests of tests" fxFlex="0 1 calc(50% - 32px)" fxFlex.lt-md="0 1 calc(50% - 32px)"
      fxFlex.lt-sm="100%">
        <h2 class="test-subject-title" *ngIf="getSubjectName(subjectBasedTests.subjectId)">Đề thi môn: {{subjectName}}</h2>
        <h2 *ngIf="subjectBasedTests.universityId">{{getUniversityName(subjectBasedTests.universityId)}}</h2>
        <div>
          <div *ngFor="let test of subjectBasedTests.tests" style="margin-bottom: 10px;">
            <app-test-card [test]="test" (testSelected)="onTestSelected($event)"></app-test-card>
          </div>
        </div>
      </div>
  </div>
  <div style="margin-top: 25px;">
    <button (click)="backAfterDoingMockTest()" mat-raised-button matStepperPrevious color="warn">Trở lại</button>
  </div>
</div>
  </mat-step>
  <mat-step  #stepFive >
    <ng-template matStepLabel>Làm bài thi</ng-template>
    <div>
      <app-exam-page (isReloadUni)="reloadUni($event)"></app-exam-page>
      
      <div >
        <button mat-raised-button matStepperPrevious color="warn">Trở lại</button>
        <!--<button mat-button class="btn-step-one" (click)="stepper.reset()">Reset</button> -->
      </div>
    </div>
  </mat-step>

</mat-horizontal-stepper>

<app-progress-spinner *ngIf="isLoading || isAuthLoading || isUserLoading || countStepperActionLoad > 0"></app-progress-spinner>


